{{extend 'longboxes_sidebar.html'}}

{{block breadcrumbs}}
<li><a href="{{=URL('collection', 'view', args=[owner.id])}}">{{=owner.screen_name}}</a></li>
<li class="active">Comic: {{=comic.title}}</li>
{{end}}

{{block pre_body}}
<div class="header-actions">
  <h2>
  {{=comic.title}}
    <small class="text-muted">
      (issue {{=comic.issue}})
    </small>
  </h2>

  <div class="btn-group" role="group">
  {{if can_edit:}}
    <a class="btn btn-danger" href="{{=URL('comic', 'delete', args=[comic.id])}}" onclick="return confirm('Are you sure you want to delete this box?')">
      <span class="glyphicon glyphicon-trash"></span>
      Delete
    </a>

    <a class="btn btn-default" href="{{=URL('comic', 'edit', args=[comic.id])}}">
      <span class="glyphicon glyphicon-pencil"></span>
      Edit
    </a>
  {{pass}}

    <button class="btn btn-success" data-toggle="modal" data-target="#add_to_box_modal">
      <span class="glyphicon glyphicon-plus-sign"></span>
      Add to box
    </button>
  </div>
</div>

{{if available_boxes:}}
  <div class="modal fade" id="add_to_box_modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Add to box</h4>
        </div>

        <form action="{{=URL('box', 'add_comic')}}" method="post">
          <input type="hidden" name="comic" value="{{=comic.id}}">

          <div class="modal-body">
            <div class="form-group">
              <label for="comic">Box</label>
              <select class="form-control" name="box">
                {{for box in available_boxes:}}
                  <option value="{{=box.id}}">{{=box.name}}</option>
                {{pass}}
              </select>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add to box</button>
          </div>
        </form>
      </div>
    </div>
  </div>
{{pass}}
{{end}}

{{block sidebar}}
<ul class="list-group">
  <li class="list-group-item">
    <h4 class="list-group-item-heading">Publisher</h4>
    <p class="list-group-item-text">{{=comic.publisher.name}}</p>
  </li>

  <li class="list-group-item">
    <h4 class="list-group-item-heading">Writers</h4>
    <p class="list-group-item-text">
      {{=', '.join(map(lambda x: x.name, writers))}}
    </p>
  </li>

  <li class="list-group-item">
    <h4 class="list-group-item-heading">Artists</h4>
    <p class="list-group-item-text">
    {{=', '.join(map(lambda x: x.name, artists))}}
    </p>
  </li>
</ul>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Belongs to</h3>
  </div>

  <ul class="list-group">
  {{for box in boxes:}}
    <li class="list-group-item">
      <a href="{{=URL('box', 'view', args=[box.id])}}">
        <span class="glyphicon glyphicon-th"></span>
        {{=box.name}}
      </a>

      {{if can_edit and box.name != 'Unfiled':}}
        <div class="pull-right">
          <a class="btn btn-xs btn-danger" href="{{=URL('box', 'remove_comic', args=[box.id, comic.id])}}" title="Remove comic from box">
            &times;
          </a>
        </div>
      {{pass}}
    </li>
  {{pass}}

    <a class="list-group-item" href="{{=URL('collection', 'view', args=[owner.id])}}">
      <span class="glyphicon glyphicon-user"></span>
      View the rest of <em>{{=owner.screen_name}}</em>'s collection...
    </a>
  </ul>
</div>
{{end}}

{{block main}}
<img class="comic-cover" src="{{=URL('default', 'download', args=[comic.cover_image])}}">

<h3>Description</h3>
<p class="lead">
{{=comic.description}}
</p>
{{end}}
